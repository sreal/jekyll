---
layout: default
title: Notes OWASP Top 10 Web Application
excerpt: Note from plural sight OWASP Top 10
---

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Notes: The OWASP Top 10 Web Application</h2>
<div class="outline-text-2" id="text-1">
<p>
These are my notes from OWASP
The Open Web application Security Project
</p>

<p>
About how to implement the top 10 in asp.NET
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Overview</h3>
<div class="outline-text-3" id="text-1-1">
<blockquote>
<p>
No-one is safe. 90% of sites have security flaws.
</p>
</blockquote>
</div>

<div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">Be pragmatic</h4>
<div class="outline-text-4" id="text-1-1-1">
<blockquote>
<p>
Making a site unhackable is unfeasible
</p>
</blockquote>

<p>
Organizations should balance between,
</p>
<ol class="org-ol">
<li>cost to protect,
</li>
<li>value of assets,
</li>
<li>likelihood of exploit.,
</li>
<li>impact of exploit
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2">The categories of attackers</h4>
<div class="outline-text-4" id="text-1-1-2">
<blockquote>
<p>
Different risk profits mean different required investments to protect.
</p>
</blockquote>

<ol class="org-ol">
<li>Hacktivists
<ul class="org-ul">
<li>social interests
</li>
</ul>
</li>
<li>Online criminals
<ul class="org-ul">
<li>cash
</li>
</ul>
</li>
<li>Nation states
<ul class="org-ul">
<li>cyber warfare
</li>
</ul>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3">OWASP</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
The Open Web application Security Project
</p>
<ul class="org-ul">
<li>Non-profits
</li>
<li>Top 10 lists are language agnostic
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4">The OWASP Top 10</h4>
<div class="outline-text-4" id="text-1-1-4">
<ol class="org-ol">
<li>Injection
</li>
<li>Cross-Site Scripting
</li>
<li>Broken Authentication and Session Management
</li>
<li>Insecure Direct Object References
</li>
<li>Cross-site request forgery
</li>
<li>Security Misconfiguration
</li>
<li>Insecure Cryptographic Storage
</li>
<li>Failure to Restrict URL Access
</li>
<li>Insufficient Transport Layer Protection
</li>
<li>Unvalidated Redirects and Forwards.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-1-1-5" class="outline-4">
<h4 id="sec-1-1-5">The Security Matrix</h4>
<div class="outline-text-4" id="text-1-1-5">
<ol class="org-ol">
<li>Threat Agents
</li>
<li>Attack Vectors
</li>
<li>Security Weaknesses
</li>
<li>Security Controls
</li>
<li>Technical Impact (Dependant on asset)
</li>
<li>Business Impact (dependent on nature of data)
</li>
</ol>
</div>

<div id="outline-container-sec-1-1-5-1" class="outline-5">
<h5 id="sec-1-1-5-1">OWASP grading system Traffic light rating system</h5>
<div class="outline-text-5" id="text-1-1-5-1">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">Color</td>
<td class="left">Threat Agent</td>
<td class="left">Attack Vector</td>
<td class="left">Weakness Prevalence</td>
<td class="left">Weakness Detectability</td>
<td class="left">Technical Impact</td>
<td class="left">Business Impact</td>
</tr>

<tr>
<td class="left">Purple</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">Very Widespread</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">Red</td>
<td class="left">&#xa0;</td>
<td class="left">Easy</td>
<td class="left">Widespread</td>
<td class="left">Easy</td>
<td class="left">Severe</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">Orange</td>
<td class="left">&#xa0;</td>
<td class="left">Average</td>
<td class="left">Common</td>
<td class="left">Average</td>
<td class="left">Moderate</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">Yellow</td>
<td class="left">&#xa0;</td>
<td class="left">Difficult</td>
<td class="left">Uncommon</td>
<td class="left">Difficult</td>
<td class="left">Minor</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-1-1-6" class="outline-4">
<h4 id="sec-1-1-6">Security depth</h4>
<div class="outline-text-4" id="text-1-1-6">
<blockquote>
<p>
Security is layered
</p>
</blockquote>

<p>
Top 10 is the starting point not the end&#x2026;
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Injection</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">The Matrix</h3>
<div class="outline-text-3" id="text-2-1">
</div><div id="outline-container-sec-2-1-1" class="outline-4">
<h4 id="sec-2-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
Anyone who send untrusted data to the system.
</p>
</div>
</div>

<div id="outline-container-sec-2-1-2" class="outline-4">
<h4 id="sec-2-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
Simple text based attack
</p>
</div>
</div>

<div id="outline-container-sec-2-1-3" class="outline-4">
<h4 id="sec-2-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-2-1-3">
</div><div id="outline-container-sec-2-1-3-1" class="outline-5">
<h5 id="sec-2-1-3-1">Prevalence&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-2-1-3-1">
<ul class="org-ul">
<li>Very prevalent, esp. in legacy code.
</li>
<li>Include SQL, LDAP, XPath queries, OS commands.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-1-3-2" class="outline-5">
<h5 id="sec-2-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-2-1-3-2">
<ul class="org-ul">
<li>Easy in code,
</li>
<li>Hard in testing
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2-1-4" class="outline-4">
<h4 id="sec-2-1-4">Technical Impact (Dependant on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-2-1-4">
<ul class="org-ul">
<li>Data loss/corruption
</li>
<li>Lack of accountability
</li>
<li>Denial of access
</li>
<li>Host take over
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-1-5" class="outline-4">
<h4 id="sec-2-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-2-1-6" class="outline-4">
<h4 id="sec-2-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-2-1-6">
<dl class="org-dl">
<dt> With regards to </dt><dd><ul class="org-ul">
<li>theft,
</li>
<li>modification
</li>
<li>deletion
</li>
</ul>
</dd>

<dt> Consider value of </dt><dd><ul class="org-ul">
<li>affected data
</li>
<li>the platform running the interpreter
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Notes:</h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Can gets additional data from the system. IE. table names by querying <code>sysobject</code> &amp; <code>xtype=char(85)</code>
</li>
<li>Blind sql injection - executing with output bubbling up into the web interface.
</li>
<li id="Untrusted data"><ul class="org-ul">
<li><b>integrity</b> is not verifiable
</li>
<li><b>intent</b> may be malicious
</li>
<li>possible payloads:
<ul class="org-ul">
<li>sql injection
</li>
<li>cross site scripting
</li>
<li>binaries containing malware
</li>
</ul>
</li>
<li>Sources:
<ul class="org-ul">
<li>url/query string
</li>
<li>form values
</li>
<li>cookies
</li>
<li>request headers
</li>
<li>external service (external web service)
</li>
<li>own database (eg. user submitted data)
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Security in Depth</h3>
<div class="outline-text-3" id="text-2-3">
<blockquote>
<p>
Security in depth: Protection in layers.
</p>
</blockquote>

<p>
Protect from db back to web tier.
</p>
</div>

<div id="outline-container-sec-2-3-1" class="outline-4">
<h4 id="sec-2-3-1">The principle of least privilege</h4>
<div class="outline-text-4" id="text-2-3-1">
<blockquote>
<p>
<b><b>Principle of least Privilege</b></b> :: every modules in a system must be able to access only the information and resources that are necessary for it's legitimate purpose.
</p>
</blockquote>

<p>
Update sql user permissions to be only what is needed.
</p>

<ul class="org-ul">
<li><code>dbowner</code> is too permissive.
</li>
<li>Give access to only tables needed.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3-2" class="outline-4">
<h4 id="sec-2-3-2">SQL Parametrization</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
Stop breaking out of <b>data context</b> (IE input parameter) into the <b>query context</b>. IE. can only change data, not the query
</p>

<ul class="org-ul">
<li>Remove online string concatenation.
</li>
<li>Use <code>new SqlCommand().Parameters.Add()</code> method instead.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3-3" class="outline-4">
<h4 id="sec-2-3-3">Stored Procedures</h4>
<div class="outline-text-4" id="text-2-3-3">
<ul class="org-ul">
<li>Always parameterized value by default.
</li>
<li>Still possible to run injection if just running an <code>exec!</code> in the storedProc. eg. building a like.
<ul class="org-ul">
<li>use <code>sp_executesql</code> not <code>exec</code>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3-4" class="outline-4">
<h4 id="sec-2-3-4">Whitelist</h4>
<div class="outline-text-4" id="text-2-3-4">
<ul class="org-ul">
<li>alway validate data
</li>
<li>explicit filter out anything not truster
</li>
</ul>

<blockquote>
<p>
Whitelist is a more future proof alternative than a blacklist
</p>
</blockquote>
</div>

<div id="outline-container-sec-2-3-4-1" class="outline-5">
<h5 id="sec-2-3-4-1">Approaches</h5>
<div class="outline-text-5" id="text-2-3-4-1">
<ol class="org-ol">
<li>Type conversion
eg. <code>int.TryParse</code> the string value coming in.
</li>
<li>Regular Expression
</li>
<li>List of known good values.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-2-3-5" class="outline-4">
<h4 id="sec-2-3-5">ORM</h4>
<div class="outline-text-4" id="text-2-3-5">
<ul class="org-ul">
<li>Automates parameterization.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2-3-6" class="outline-4">
<h4 id="sec-2-3-6">Automation Tools</h4>
<div class="outline-text-4" id="text-2-3-6">
<blockquote>
<p>
Automation reduces the bar to entry. IE makes injection easier.
</p>
</blockquote>

<ul class="org-ul">
<li><a href="http://havij-advanced-sql-injection.software.informer.com/">http://havij-advanced-sql-injection.software.informer.com/</a>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Summary</h3>
<div class="outline-text-3" id="text-2-4">
<ul class="org-ul">
<li>Apply principle of least privilege
</li>
<li>parameterize untrusted data
</li>
<li>stored proces offer protection via parameterization
</li>
<li>always validate untrusted data against a whitelist
</li>
<li>ORM parameterize nativly
</li>
<li>Remember automated tools are easy to use
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Cross Site Scripting (XSS)</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">The Matrix</h3>
<div class="outline-text-3" id="text-3-1">
</div><div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
Anyone who send untrusted data to the system.
</p>
</div>
</div>

<div id="outline-container-sec-3-1-2" class="outline-4">
<h4 id="sec-3-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Simple text based attack
</p>
</div>
</div>

<div id="outline-container-sec-3-1-3" class="outline-4">
<h4 id="sec-3-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-3-1-3">
</div><div id="outline-container-sec-3-1-3-1" class="outline-5">
<h5 id="sec-3-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="purple">purple</span></span></h5>
<div class="outline-text-5" id="text-3-1-3-1">
<ul class="org-ul">
<li>most common on web
</li>
<li id="3 Types"><ul class="org-ul">
<li>Stored
</li>
<li>Refleced
</li>
<li>DOM based
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-1-3-2" class="outline-5">
<h5 id="sec-3-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="easy">easy</span></span></h5>
<div class="outline-text-5" id="text-3-1-3-2">
<ul class="org-ul">
<li>Easy via code
</li>
<li>Easy via testing
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-3-1-4" class="outline-4">
<h4 id="sec-3-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-3-1-4">
<dl class="org-dl">
<dt> Execute scripts in victems browser </dt><dd><ul class="org-ul">
<li>hijack session
</li>
<li>deface web sites
</li>
<li>insert hostile content
</li>
<li>redirect users
</li>
<li>hijack via malware
</li>
</ul>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-3-1-5" class="outline-4">
<h4 id="sec-3-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-3-1-6" class="outline-4">
<h4 id="sec-3-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-3-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>affected system
</li>
<li>all data it processes
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>public exposure of exploit
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Notes:</h3>
<div class="outline-text-3" id="text-3-2">
<blockquote>
<p>
XSS attacks are possilbe from the payload breakout from the data context to a output encoded context.
</p>
</blockquote>

<ul class="org-ul">
<li>Data that manipulates the markup context. IE. Data has broken out of data context onto the markup context.
</li>
<li>Power of xss is to send the dom element elsewhere. Eg. cookies.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Security in depth</h3>
<div class="outline-text-3" id="text-3-3">
</div><div id="outline-container-sec-3-3-1" class="outline-4">
<h4 id="sec-3-3-1">Output encoding</h4>
<div class="outline-text-4" id="text-3-3-1">
<blockquote>
<p>
XSS mitigation is making sure untrusted data is rendered the same whay it was entered.
</p>
</blockquote>

<ul class="org-ul">
<li>Use output encoding, (eg. <code>html encoding</code>) for display the characters.
</li>
<li id="Contexts that require output encoding"><ul class="org-ul">
<li>CSS
</li>
<li>HTML, HTML attribute, HTML form url
</li>
<li>Javascript
</li>
<li>LDAP distungished name, LDAP filter
</li>
<li>URL, URL path
</li>
<li>XML, XML attribute
</li>
</ul>
</li>
<li>Frameworks encoding actions
<ul class="org-ul">
<li>WebForms: Different controls will encode differently.
</li>
<li>ASP.MVC: Razor encodes everything by default.
</li>
</ul>
</li>
</ul>

<blockquote>
<p>
Persistent XSS is stored in the datbase.
</p>
</blockquote>

<blockquote>
<p>
Each encoding context required different encoding sequences.
</p>
</blockquote>

<blockquote>
<p>
Using a proven library is the right approach. <b><b>Do not roll your own</b></b>
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-3-3-2" class="outline-4">
<h4 id="sec-3-3-2">Whitelist against string</h4>
<div class="outline-text-4" id="text-3-3-2">
<ul class="org-ul">
<li>regex is a viable option against string data
</li>
<li>Be careful not to miss valid chars. eg. ~@"<sup>\p</sup>{L} \.&#x00ad;\+$"~  ~ misses quotes.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-3-3" class="outline-4">
<h4 id="sec-3-3-3">Default secure validation</h4>
<div class="outline-text-4" id="text-3-3-3">
<p>
Requestion validation is on by default in ASP.NET so attacks will be caught before request hits usercode.
</p>

<p>
Returns <code>A potentially dangerous...</code> error is returned.
</p>

<div class="org-src-container">

<pre class="src src-xml">&lt;configuration&gt;
  &lt;system.web&gt;
&lt;!-- explictly enable request validation,
`validateRequest` attribute will be missing and `true` by default --&gt;
    &lt;pages validateRequest="true"&gt; ... &lt;/pages&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
</div>

<dl class="org-dl">
<dt> <code>validateRequest</code> can be disabled </dt><dd><ul class="org-ul">
<li>Pre-ASP.NET 4.5 - done on the page level. eg. for a WYSIWYG editor.
</li>
<li>ASP.NET 4.5 - done at control level, or code behind.
</li>
<li>ASP.MVC - The decorator <code>AllowHtml</code> can be set on a Model value.
</li>
</ul>
</dd>
</dl>

<div class="org-src-container">

<pre class="src src-xml">&lt;%@ Page Title="disabled request validation" ValidateRequest="false" Language="C#..." /&gt;
</pre>
</div>

<blockquote>
<p>
Code as if request validation doesn't exist. It is a last line of defense.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-3-3-4" class="outline-4">
<h4 id="sec-3-3-4">Browser defense</h4>
<div class="outline-text-4" id="text-3-3-4">
<ol class="org-ol">
<li>Some browers blocked thing on their own.
</li>
<li>Custom headers provide a method to control browser behaviour.
</li>
<li>Cannot rely on brower implementations
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-3-3-5" class="outline-4">
<h4 id="sec-3-3-5">Obuscating the Attack</h4>
<div class="outline-text-4" id="text-3-3-5">
<ul class="org-ul">
<li>Encode the entire url.
</li>
<li>Use a url shortener.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3-3-6" class="outline-4">
<h4 id="sec-3-3-6">Summary</h4>
<div class="outline-text-4" id="text-3-3-6">
<ul class="org-ul">
<li>Output encoding is base of XSS protection
</li>
<li>Default Encoding is performed differently be different frameworks
</li>
<li>Whitelist are important
</li>
<li>Request validation isa safetly net
</li>
<li>Code as if XSS is in the database
</li>
<li>brower defenses are inconsistent
</li>
<li>Expect attack obfuscation to occur
</li>
</ul>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Broken Authentication and Session Management</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">The Matrix</h3>
<div class="outline-text-3" id="text-4-1">
</div><div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Anonymous external attackers trying to steal accounts, Insiders wanting to hide their actions
</p>
</div>
</div>

<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
Leaks/flaws in authentication/session management functions to impersonate users
</p>
</div>
</div>

<div id="outline-container-sec-4-1-3" class="outline-4">
<h4 id="sec-4-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-4-1-3">
</div><div id="outline-container-sec-4-1-3-1" class="outline-5">
<h5 id="sec-4-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-4-1-3-1">
<ul class="org-ul">
<li>from custom auth and session management schemes
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-1-3-2" class="outline-5">
<h5 id="sec-4-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-4-1-3-2">
<ul class="org-ul">
<li>Hard because of uniquieness of each scheme
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-4" class="outline-4">
<h4 id="sec-4-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-4-1-4">
<ul class="org-ul">
<li>Allow <b><b>all</b></b> account to be attacked
</li>
<li>Full priveleages of attacked user
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-1-5" class="outline-4">
<h4 id="sec-4-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-4-1-6" class="outline-4">
<h4 id="sec-4-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-4-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>affected data
</li>
<li>application functions
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>public exposure of vunerability
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Notes:</h3>
<div class="outline-text-3" id="text-4-2">
<blockquote>
<p>
Never have sensitive information in the url.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Security in depth</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1">Session Persistence</h4>
<div class="outline-text-4" id="text-4-3-1">
</div><div id="outline-container-sec-4-3-1-1" class="outline-5">
<h5 id="sec-4-3-1-1">Url Session Persistence</h5>
<div class="outline-text-5" id="text-4-3-1-1">
<p>
<b><b>This is unsecure</b></b>
</p>

<p>
HTTP is a stateless protocol, putting the session in the url is a hack to get around this.
</p>

<dl class="org-dl">
<dt> Problem is the session would be stored via </dt><dd><ul class="org-ul">
<li>sharing on social media
</li>
<li>Logging
</li>
<li>Browser history
</li>
</ul>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-4-3-1-2" class="outline-5">
<h5 id="sec-4-3-1-2">Session Persistence in a cookie</h5>
<div class="outline-text-5" id="text-4-3-1-2">
<p>
Works by sending the cookie with the request. The cookie is not shared via url
</p>

<p>
Problem is if cookies are not enabled in the browser.
</p>
</div>
</div>

<div id="outline-container-sec-4-3-1-3" class="outline-5">
<h5 id="sec-4-3-1-3">ASP.NET Types</h5>
<div class="outline-text-5" id="text-4-3-1-3">
<ol class="org-ol">
<li>UseUri
</li>
<li>UseCookies (default)
</li>
<li>UseDeviceProfile - Cookies with fallback.
</li>
<li>AutoDetect
</li>
</ol>

<blockquote>
<p>
It may be worth not allowing uses without cookies enabled.
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2">Broken Authentication</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
Rolling your own authentication is hard. The recommendation is to use pre-rolled.
Eg. ASP.NET's <code>MembershipProvider</code>
</p>
</div>
</div>

<div id="outline-container-sec-4-3-3" class="outline-4">
<h4 id="sec-4-3-3">Session and forms timout</h4>
<div class="outline-text-4" id="text-4-3-3">
<blockquote>
<p>
Timeout is a balance between the convenience between
</p>
<ol class="org-ol">
<li>user remaining logged in and
</li>
<li>session becoming hijacked.
</li>
</ol>
</blockquote>

<dl class="org-dl">
<dt> ASP Default </dt><dd><ul class="org-ul">
<li>Session : 20 minutes
</li>
<li id="Forms">30 minutes
</li>
</ul>
</dd>
</dl>

<blockquote>
<p>
By default, A new ASP.NET Forms application will increase the timeout to 2 days
</p>
</blockquote>

<dl class="org-dl">
<dt> Types </dt><dd><ul class="org-ul">
<li>Sliding - <code>&lt;forms sliding="false" /&gt;</code> - Ends XX time after inactivy.
</li>
<li>Fixed - <code>default</code> - Explict duration.
</li>
</ul>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-4-3-4" class="outline-4">
<h4 id="sec-4-3-4">Other Needed Patterns.</h4>
<div class="outline-text-4" id="text-4-3-4">
<ol class="org-ol">
<li>Cryptographically secure password credential storage.
</li>
<li>Robust minimum password criteria.
</li>
<li>Never send password by email.
</li>
<li>Protect session IDs in cookies.
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4">Summary</h3>
<div class="outline-text-3" id="text-4-4">
<ul class="org-ul">
<li>Keep session IDs out of Url, use cookies
</li>
<li>Use ASP.NET membership provider
</li>
<li>Customise session &amp; forms timeout
</li>
<li>Disable sliding forms authentication if possible
</li>
<li>Broken auth is a broad risk and is highly related to other top 10.
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Insecure Direct Object References</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">The Matrix</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
Users with partial access
</p>
</div>
</div>

<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="easy">easy</span></span></h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
Authorised user changes a parameter value, and get access to another object the user isn't aithourized for.
</p>
</div>
</div>

<div id="outline-container-sec-5-1-3" class="outline-4">
<h4 id="sec-5-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-5-1-3">
</div><div id="outline-container-sec-5-1-3-1" class="outline-5">
<h5 id="sec-5-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-5-1-3-1">
<ul class="org-ul">
<li>when the user is used  page, application don't always validate the user.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-1-3-2" class="outline-5">
<h5 id="sec-5-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-5-1-3-2">
<ul class="org-ul">
<li>Testers can easily manipulate values to detect such flaws
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-4" class="outline-4">
<h4 id="sec-5-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-5-1-4">
<ul class="org-ul">
<li>Compromise all data referenced by the parameter
</li>
<li>Commonly all data of that type
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-1-5" class="outline-4">
<h4 id="sec-5-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-5-1-6" class="outline-4">
<h4 id="sec-5-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-5-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>exposed data
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>public exposure of vunerability
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Notes</h3>
<div class="outline-text-3" id="text-5-2">
<blockquote>
<p>
It's about gaining access to other user accounts.
</p>
</blockquote>

<dl class="org-dl">
<dt> Direct Object Reference </dt><dd><ul class="org-ul">
<li>Observable key use to identify an individual database record.
</li>
</ul>
</dd>
<dt> Risk </dt><dd><ul class="org-ul">
<li>Manipulation of a direct object reference
</li>
<li>Direct reference are often
<ul class="org-ul">
<li>Patterns (incrementing
</li>
<li>Natural Keys/Logicdata (username)
</li>
<li>Discoverable data (social security numbers)
</li>
</ul>
</li>
<li>Direct object references can then be brute forced/scripted for access.
</li>
</ul>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">Security in Depth</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1">Access Controls</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
Correct access control makes sure users can only access the appropriate records.
</p>

<blockquote>
<p>
Heart of Indirect Object Reference Access is a lack Access controls.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-5-3-2" class="outline-4">
<h4 id="sec-5-3-2">Indirect Object Reference Map</h4>
<div class="outline-text-4" id="text-5-3-2">
<p>
An abstration between what is publicly obwservable and the individual database record.
</p>

<ul class="org-ul">
<li>Map internal records to <b>temporary</b>, <b>user specific</b>, <b>random</b> record.
</li>
<li>Server maintains a map between the the temp record and the internal value
</li>

<li id="Important priciples"><ul class="org-ul">
<li>Temporary
</li>
<li>User specific
</li>
<li>Indirect reference is random
</li>
</ul>
</li>

<li id="Considerations when building"><ul class="org-ul">
<li>Multiple front ends?
</li>
<li>Potential overhead?
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-3-3" class="outline-4">
<h4 id="sec-5-3-3">Obfuscation via Undiscoverable surrogate keys</h4>
<div class="outline-text-4" id="text-5-3-3">
<ul class="org-ul">
<li>INterger and natural string types can be enumerated
</li>
<li>Non pattern bases surrogate keys add further obfuscation (eg GUID)
</li>
<li>Security through obscurity,
</li>
<li>There are tradeoffs.
</li>
<li>Not real proper access control
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">Summary</h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Insecure direct object reference are aboutaccess control
</li>
<li>Indirect references can be used to conceal internal keys
</li>
<li>Surrogate keys can assist in obfuscation
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Cross Site Request Forgery (CSRF, XSRF)</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">The Matrix</h3>
<div class="outline-text-3" id="text-6-1">
</div><div id="outline-container-sec-6-1-1" class="outline-4">
<h4 id="sec-6-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-6-1-1">
<p>
Anyone who can trick users into submitting a request to your site.
</p>
</div>
</div>

<div id="outline-container-sec-6-1-2" class="outline-4">
<h4 id="sec-6-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-6-1-2">
<p>
Attecker create forged HTTP request and tricks user into submitting them.
If the user is authenticated the attack succeeds.
</p>
</div>
</div>

<div id="outline-container-sec-6-1-3" class="outline-4">
<h4 id="sec-6-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-6-1-3">
</div><div id="outline-container-sec-6-1-3-1" class="outline-5">
<h5 id="sec-6-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-6-1-3-1">
<ul class="org-ul">
<li>malicious request are indishtinushable from legitimate requests
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-3-2" class="outline-5">
<h5 id="sec-6-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-6-1-3-2">
<ul class="org-ul">
<li>Easy via pen testing or code analysis
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-6-1-4" class="outline-4">
<h4 id="sec-6-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-6-1-4">
<ul class="org-ul">
<li>Change any data the victen can change
</li>
<li>Perform any function the victem can perform
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6-1-5" class="outline-4">
<h4 id="sec-6-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-6-1-6" class="outline-4">
<h4 id="sec-6-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-6-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>affected data or application functions
</li>
<li>Imagine not being sure if the user performed the actions
</li>
</ul>
</dd>

<dt> Include in consideration impact on </dt><dd><ul class="org-ul">
<li>customer
</li>
<li>reputation
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Notes</h3>
<div class="outline-text-3" id="text-6-2">
<blockquote>
<p>
CSRF is about getting the browser to reconstruction of a legitimate request with a malicious payload.
</p>
</blockquote>

<p>
The CSRF process
</p>
<ol class="org-ol">
<li>Authenticated session are persisted via cookie
</li>
<li>Attacking site recreates a legitimately formed request
</li>
<li>Browser is tricked into makeing the request.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">Security in Depth</h3>
<div class="outline-text-3" id="text-6-3">
</div><div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1">Antiforgery tokens</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
<b>A CSRF token</b> is a random string known to both legitimate page where the form is and the browser via cookie.
</p>

<blockquote>
<p>
The token is know to the page and is validated against the value in the cookie
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-6-3-2" class="outline-4">
<h4 id="sec-6-3-2">CSRF Falicies</h4>
<div class="outline-text-4" id="text-6-3-2">
<ol class="org-ol">
<li>Implement referrer checking wil restrict cross-domain request
Partially helpful, but this does not address the risk introduced by XSS.
</li>
<li>Disable HTTP GET on at-risk pages
Attacker can still construct POST requests
</li>
<li>Valida the IP address from loading page to POSTing IP.
Does not help since it will be the client's IP each time
</li>
</ol>

<blockquote>
<p>
The only real defense is CSRF tokens.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-6-3-3" class="outline-4">
<h4 id="sec-6-3-3">Browser Defense</h4>
<div class="outline-text-4" id="text-6-3-3">
<ul class="org-ul">
<li>CRSF risk may be exploited by Cros-Origin-Resource Sahring (CORS)
</li>
<li>Drifferent vrowsers provide variting levels against CORS
</li>
<li>Should never be relied on.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4">Summary</h3>
<div class="outline-text-3" id="text-6-4">
<ul class="org-ul">
<li>All about browser being tricked into a legitimate request with amlicious payload
</li>
<li>it's the authenticated user state that is abused
</li>
<li>Only real mitigation is anti-forgery token.
</li>
<li>Request always seem legitimate
</li>
<li>Browser defnese should not be relied on.
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Security Misconfiguration</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">The Matrix</h3>
<div class="outline-text-3" id="text-7-1">
</div><div id="outline-container-sec-7-1-1" class="outline-4">
<h4 id="sec-7-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-7-1-1">
<ul class="org-ul">
<li>Anonymous external attackers, users withown accounts, insiders trying to hide actions.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-1-2" class="outline-4">
<h4 id="sec-7-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-7-1-2">
<ul class="org-ul">
<li>acccesses default accounts, unused pages, unpathed flaes unprotected files,
</li>
<li>to gain access/knowlege of the system
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-1-3" class="outline-4">
<h4 id="sec-7-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-7-1-3">
</div><div id="outline-container-sec-7-1-3-1" class="outline-5">
<h5 id="sec-7-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-7-1-3-1">
<ul class="org-ul">
<li>HAppen at any level, devs and admin need to work together
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-1-3-2" class="outline-5">
<h5 id="sec-7-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-7-1-3-2">
<ul class="org-ul">
<li>Automatic scanners are usefull for checking missing patches, misconfigurations, default accounts, unnecessary services
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-7-1-4" class="outline-4">
<h4 id="sec-7-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-7-1-4">
<ul class="org-ul">
<li>Unauthorized access to system data or functionality
</li>
<li>Complete system compromises
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-1-5" class="outline-4">
<h4 id="sec-7-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-7-1-6" class="outline-4">
<h4 id="sec-7-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-7-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>complete system
</li>
<li>all data
</li>
</ul>
</dd>

<dt> Include in consideration impact on </dt><dd><ul class="org-ul">
<li>complete compromise without knowledge of it
</li>
<li>recovery costs
</li>
<li>modification of data over time
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Notes</h3>
<div class="outline-text-3" id="text-7-2">
<ul class="org-ul">
<li>YSOD is a Security Misconfiguration. Internal exceptions should not be public
</li>
</ul>

<blockquote>
<p>
Probe application ith data outside of expected range
</p>
</blockquote>

<ul class="org-ul">
<li>Unsecured ELMAR is a commonly misconfigured
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Security in Depth</h3>
<div class="outline-text-3" id="text-7-3">
</div><div id="outline-container-sec-7-3-1" class="outline-4">
<h4 id="sec-7-3-1">Configure Custom Errors</h4>
<div class="outline-text-4" id="text-7-3-1">
<p>
To stop automated tools fromscrapping for errors:
</p>

<ol class="org-ol">
<li>Enabling Custom Errors - (Hide internal implementation details)
</li>
<li>Rediret to 404/Error page, (Hide the custom error 500)
</li>
<li>Rewrite the response - (Hide url/response code from displaying the error)
</li>
</ol>

<div class="org-src-container">

<pre class="src src-xml">&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;customErrors mode="On" defaultRedirect="Error.aspx" responseRewrite="true"/&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-3-2" class="outline-4">
<h4 id="sec-7-3-2">Typical Risks</h4>
<div class="outline-text-4" id="text-7-3-2">
</div><div id="outline-container-sec-7-3-2-1" class="outline-5">
<h5 id="sec-7-3-2-1">Trace</h5>
<div class="outline-text-5" id="text-7-3-2-1">
<p>
Tracing should be disabled/remove due to the sensitive information
</p>

<div class="org-src-container">

<pre class="src src-xml">&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;trace mode="false"/&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-3-2-2" class="outline-5">
<h5 id="sec-7-3-2-2">Keep Libraries Updated</h5>
<div class="outline-text-5" id="text-7-3-2-2">
<ul class="org-ul">
<li>NuGet Modules upgrades should be reviewed.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-3-2-3" class="outline-5">
<h5 id="sec-7-3-2-3">Storing Sensitive Information</h5>
<div class="outline-text-5" id="text-7-3-2-3">
<ul class="org-ul">
<li>Encypting the data on the web.config using the encryption key on the server. It is tied then to the box.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh"># encrypt
/c/windows/microsoft.net/vxx&gt; aspnet_regiis -site "site" -app "/" -pe connectionStrings
decrypt
/c/windows/microsoft.net/vxx&gt; aspnet_regiis -site "site" -app "/" -pd connectionStrings
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-3-2-4" class="outline-5">
<h5 id="sec-7-3-2-4">Config Transforms</h5>
<div class="outline-text-5" id="text-7-3-2-4">
<p>
Remove the dangerous configuration setting in the web.release.config.
Transform must be done through the publish process.
</p>
</div>
</div>

<div id="outline-container-sec-7-3-2-5" class="outline-5">
<h5 id="sec-7-3-2-5">Retail Mode</h5>
<div class="outline-text-5" id="text-7-3-2-5">
<p>
MAchine level override, safety net for config mistakes.
</p>

<div class="org-src-container">

<pre class="src src-xml">&lt;configuration&gt;
  &lt;system.web&gt;
    &lt;deployment retail="true"/&gt;
  &lt;/system.web&gt;
&lt;/configuration&gt;
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4">Summary</h3>
<div class="outline-text-3" id="text-7-4">
<ul class="org-ul">
<li>Small changes can product large security issue.
</li>
<li>Have a strategy for keeping frameworks current
</li>
<li>Protect sensitive data in Web.config
</li>
<li>Automate scrubbing of sensitive information in configs
</li>
<li>retailMode can be used as a safetly net.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Insecure Cryptographic Storage</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">The Matrix</h3>
<div class="outline-text-3" id="text-8-1">
</div><div id="outline-container-sec-8-1-1" class="outline-4">
<h4 id="sec-8-1-1">Threat agents</h4>
<div class="outline-text-4" id="text-8-1-1">
<ul class="org-ul">
<li>user of your system
</li>
<li>internal administrators
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-1-2" class="outline-4">
<h4 id="sec-8-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h4>
<div class="outline-text-4" id="text-8-1-2">
<ul class="org-ul">
<li>Attackers don't ussually break crypto
</li>
<li>They break something else to get keys, copies of data, or access data via automatic decryption channels
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-1-3" class="outline-4">
<h4 id="sec-8-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-8-1-3">
</div><div id="outline-container-sec-8-1-3-1" class="outline-5">
<h5 id="sec-8-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h5>
<div class="outline-text-5" id="text-8-1-3-1">
<ul class="org-ul">
<li>Most common flaw is not encrypting data that should be.
</li>
<li>When encryption is used: unsafe key gen, not rotating keys, or weak algorithms, is common
</li>
<li>Weak or non-salted password
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-1-3-2" class="outline-5">
<h5 id="sec-8-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h5>
<div class="outline-text-5" id="text-8-1-3-2">
<ul class="org-ul">
<li>Difficult remotlely
</li>
<li>Ussually needs to exploit something else first.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-8-1-4" class="outline-4">
<h4 id="sec-8-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-8-1-4">
<ul class="org-ul">
<li>Frequently compromises all data that should be encrypted
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-1-5" class="outline-4">
<h4 id="sec-8-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-8-1-6" class="outline-4">
<h4 id="sec-8-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-8-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>lost data
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>reputation
</li>
<li>legal implocations
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Notes</h3>
<div class="outline-text-3" id="text-8-2">
<ul class="org-ul">
<li>Attackers use tools and dictionaries.
<ul class="org-ul">
<li><a href="https://hashcat.net/oclhashcat/">OclHashCat</a> is a cracking tool
</li>
<li>hashkiller.com.dlc
</li>
</ul>
</li>
</ul>

<blockquote>
<p>
The ASP.NET default password provider is basically useless.
</p>
</blockquote>

<p>
Cyrptographioc storage is the final line of defense.
</p>

<dl class="org-dl">
<dt> 3 common password storage </dt><dd><ol class="org-ol">
<li>Plain text
</li>
<li>Encrypted
</li>
<li>Hashed
</li>
</ol>
</dd>
<dt> (no term) </dt><dd>Encryption is reversible, decyrpting with the same key is symetric encryption.
</dd>
</dl>

<blockquote>
<p>
In reality the goal is making it not feasible to crack the passwords in the first place.
</p>
</blockquote>

<p>
Hashing
</p>
<ul class="org-ul">
<li>is one way
</li>
<li>keyless
</li>
<li>is a deterministic algorithm
<ul class="org-ul">
<li>result is the same
</li>
</ul>
</li>
<li>System never uses real passwords.
</li>

<li id="Rainbow tables"><ul class="org-ul">
<li>List of hashs and values
</li>
<li>Are a simple way to find hashes.
</li>
<li>Precomputed
</li>
<li>Get large fast
</li>
</ul>
</li>
</ul>

<p>
Salting
</p>
<ul class="org-ul">
<li>Without salt the password hashes are easy to find
</li>
<li>Salt is random byte to add to a password
<ul class="org-ul">
<li>Store Hashed password + salt.
</li>
<li>Forces rainbow tables and google useless.
</li>
</ul>
</li>
<li>Still crackable but it takes time.
<ul class="org-ul">
<li>GPUs are very good at this
</li>
</ul>
</li>
<li>Dictionaries imporve cracking hit rate.
</li>
</ul>

<p>
Not encryption
</p>
<ul class="org-ul">
<li>Rot13 / Base64 is not cryptographic.
</li>
</ul>

<blockquote>
<p>
One ought design systems under the assumption
that the enemy will immediately gain full
familiarity with the,
</p>

<p>
&#x2013; Kerchhoffs' principle
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-8-3" class="outline-3">
<h3 id="sec-8-3">Security in Depth</h3>
<div class="outline-text-3" id="text-8-3">
</div><div id="outline-container-sec-8-3-1" class="outline-4">
<h4 id="sec-8-3-1">Hashing</h4>
<div class="outline-text-4" id="text-8-3-1">
</div><div id="outline-container-sec-8-3-1-1" class="outline-5">
<h5 id="sec-8-3-1-1">Decrease the rate the MembershipProvider calculates hashes.</h5>
<div class="outline-text-5" id="text-8-3-1-1">
<ul class="org-ul">
<li>PBDK2 : Password Based Key Derivation Function 2
</li>
<li>Default ASP.MVC
<ul class="org-ul">
<li>ASP.MVC4 Hashes the password 1000 times. <b>This values is not changable</b>.
</li>
</ul>
</li>
<li>BCrypt.Net
<ul class="org-ul">
<li>BCrypt allows increaseing the workload to generate the password fo the site.
</li>
</ul>
</li>
<li>Zetetic
<ul class="org-ul">
<li>Defaults to 5000 computations of PBDK2
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-3-1-2" class="outline-5">
<h5 id="sec-8-3-1-2">Other considerations</h5>
<div class="outline-text-5" id="text-8-3-1-2">
<ul class="org-ul">
<li>Overload for server, possible opportunity for DDOS attack
</li>
<li>Is a good balance for now good for tomorrow.
</li>
<li>Web Servers hash with the CPU but cracking is done via GPU.
</li>
<li>Can alway upgrade the hashing algorithm, but passwords need to be upgraded. (Track hashing algo next to passwords)
</li>
</ul>

<blockquote>
<p>
There is no one size fits all.
Balance, resource to risk.
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-sec-8-3-2" class="outline-4">
<h4 id="sec-8-3-2">Encryption</h4>
<div class="outline-text-4" id="text-8-3-2">
<ul class="org-ul">
<li>Symetric encryption use a single password for encryption and decryption
</li>
<li>Asymetric using a public prive key pair
</li>
<li>Is reversible for both cases.
</li>
<li id="Challenge of key management"><ul class="org-ul">
<li>encryption is useless is private key is known
</li>
<li>most compromised datastores, often include the source files with the private keys
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8-3-3" class="outline-4">
<h4 id="sec-8-3-3">Data Protection API (DPApi</h4>
<div class="outline-text-4" id="text-8-3-3">
<ul class="org-ul">
<li>Uses the machine key for encryption
</li>
<li>Included in <code>System.Security.Cryptography.ProtectedData</code> namespace
<ul class="org-ul">
<li>Processes can share data with <code>LocalMachine</code>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-8-4" class="outline-3">
<h3 id="sec-8-4">Summary</h3>
<div class="outline-text-3" id="text-8-4">
<ul class="org-ul">
<li>Cryptographic storeage is the last line of defnese
</li>
<li>HAshing is about slowing attackers down
</li>
<li>Key management is the issues in encryption
</li>
<li>Some things just are not encryption (base64 / rot13)
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">Failure to restrict URL Access</h2>
<div class="outline-text-2" id="text-9">
</div><div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1">The Matrix</h3>
<div class="outline-text-3" id="text-9-1">
</div><div id="outline-container-sec-9-1-1" class="outline-4">
<h4 id="sec-9-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-9-1-1">
<ul class="org-ul">
<li>Anyone with network access to send a request to the application
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-1-2" class="outline-4">
<h4 id="sec-9-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h4>
<div class="outline-text-4" id="text-9-1-2">
<ul class="org-ul">
<li>Changes to a url grants access to privileged page.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-1-3" class="outline-4">
<h4 id="sec-9-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-9-1-3">
</div><div id="outline-container-sec-9-1-3-1" class="outline-5">
<h5 id="sec-9-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h5>
<div class="outline-text-5" id="text-9-1-3-1">
<ul class="org-ul">
<li>Not always protecting page request properly,
</li>
<li>routes misconfigured, devs forget backend checks.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-1-3-2" class="outline-5">
<h5 id="sec-9-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-9-1-3-2">
<ul class="org-ul">
<li>Testing is easy, finding which pages to exist is hard
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-9-1-4" class="outline-4">
<h4 id="sec-9-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-9-1-4">
<ul class="org-ul">
<li>Allows attackes unauthorized functionaliy
</li>
<li>Admin functions are key targets
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-1-5" class="outline-4">
<h4 id="sec-9-1-5">Security Controls</h4>
</div>

<div id="outline-container-sec-9-1-6" class="outline-4">
<h4 id="sec-9-1-6">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-9-1-6">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>exposed functions
</li>
<li>data exposed by the functions
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>reputation if publicised
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2">Notes</h3>
<div class="outline-text-3" id="text-9-2">
<p>
Example is insufficient access controls on administrative pages
Similar to Insecure Direct Reference Objects
</p>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3">Security in Depth</h3>
<div class="outline-text-3" id="text-9-3">
</div><div id="outline-container-sec-9-3-1" class="outline-4">
<h4 id="sec-9-3-1">Access Controls in ASP.net</h4>
<div class="outline-text-4" id="text-9-3-1">
<ol class="org-ol">
<li>Path level in web.config <code>location</code> element, and <code>Roles</code> (location level is pretty heavy handed)
</li>
<li>Method level in class using <code>principal</code> permissions
</li>
<li>Entire MVC controller with <code>Authorize</code> attirubue
</li>
<li>MVC controller action with <code>Authorize</code> attribute
</li>
<li>Any point in code using ASP.NET <code>Identity</code> and <code>Role</code> Feature
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-9-3-2" class="outline-4">
<h4 id="sec-9-3-2">Gotchas</h4>
<div class="outline-text-4" id="text-9-3-2">
<ul class="org-ul">
<li>Overlooked URLs (api endpoints, resources (docs, pdf))
</li>
<li>Obfuscation is not access control (urls, ips&#x2026;)
</li>
<li>Urls with credential (caching, proxies, included https&#x2026;)
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4">Summary</h3>
<div class="outline-text-3" id="text-9-4">
<ul class="org-ul">
<li>Many authorization method in ASP.NET
</li>
<li>Roles base is simple using ASP.NEDT native features
</li>
<li>There are gotchas with overlooked and obfuscated urls
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">Insufficuent Transport Layer Protection</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1">The Matrix</h3>
<div class="outline-text-3" id="text-10-1">
</div><div id="outline-container-sec-10-1-1" class="outline-4">
<h4 id="sec-10-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-10-1-1">
<ul class="org-ul">
<li>Anyone who can monitor network traffic
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-1-2" class="outline-4">
<h4 id="sec-10-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h4>
<div class="outline-text-4" id="text-10-1-2">
<ul class="org-ul">
<li>Difficulty comes from monitoriing while the user is using the website
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-1-3" class="outline-4">
<h4 id="sec-10-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-10-1-3">
</div><div id="outline-container-sec-10-1-3-1" class="outline-5">
<h5 id="sec-10-1-3-1">Prevalence&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h5>
<div class="outline-text-5" id="text-10-1-3-1">
<ul class="org-ul">
<li>App use ssl/tls during authentication but not elsewhere.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-1-3-2" class="outline-5">
<h5 id="sec-10-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-10-1-3-2">
<ul class="org-ul">
<li>Detecting basic flaws is easy. THe more sublte flaws involves looking at desing of application and configuration of the server
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10-1-4" class="outline-4">
<h4 id="sec-10-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-10-1-4">
<ul class="org-ul">
<li>Accoutn theft
</li>
<li>Facilitation of phishing, and Man in the middle attacks
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-1-5" class="outline-4">
<h4 id="sec-10-1-5">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-10-1-5">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>data exposed on the communications channel
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>confidentiality
</li>
<li>integrity needed by both pariticpants.
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2">Notes</h3>
<div class="outline-text-3" id="text-10-2">
<p>
Attacker is a rogue access point the victem connects to. The attack then just passes stuff through.
</p>

<p>
Attacker can capture the packers with Wireshark.
</p>
<ul class="org-ul">
<li>Filter by HTTP
</li>
<li>TCP stream give the details (.aspxcookie) of requests.
</li>
</ul>

<p>
Certificates must be fetch by an authentic Certificate Authority
</p>
</div>
</div>

<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3">Security in Depth</h3>
<div class="outline-text-3" id="text-10-3">
</div><div id="outline-container-sec-10-3-1" class="outline-4">
<h4 id="sec-10-3-1">Enable Secure Cookies</h4>
<div class="outline-text-4" id="text-10-3-1">
<p>
Cookies with Secure flag set will not be sent to non-http requests.
The Secure flag will only be set by the server, The browsers does not send the cookie with the flag.
</p>

<p>
Different level of cookie security
</p>
<ol class="org-ol">
<li>Enable SSL for the authentication cookie
</li>
<li>Enable SSL for all cookies
</li>
<li>Keep a cookie as non-secure
</li>
</ol>

<div class="org-src-container">

<pre class="src src-xml">&lt;system.web&gt;
  &lt;authentication mode="Forms"&gt;
    &lt;forms loginUrl="~/Account/Login/" timeout="2880" requireSSL="true" /&gt;
  &lt;/authentication&gt;
&lt;system.web&gt;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-xml">&lt;system.web&gt;
  &lt;&lt;httpCookies requireSSL="true" /&gt;
&lt;/system.web&gt;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-csharp">Response.Cookies.Add(new HttpCookie("UnsecureCookie"){
  Value = "cookie-value",
  Secure - false;
});
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-3-2" class="outline-4">
<h4 id="sec-10-3-2">Force HTTPS</h4>
<div class="outline-text-4" id="text-10-3-2">
<p>
For Web Forms,
</p>

<div class="org-src-container">

<pre class="src src-csharp">/* On Page_Load */
// Be careful that the box actually runnning this is handling the cert (ie. NOT behind a load balancer)
if (Request.IsSecureConnection()) {
  var secureUrl = GetUrl().replace("http", "https");
  Response.RedirectPermanent(secureUrl);
}
</pre>
</div>

<p>
For ASP.MVC, just use an attribute per action,
</p>

<div class="org-src-container">

<pre class="src src-csharp">[RequireHttps]
public ActionResult SomeActionTheMustBeHTTPSListRegister() { return View(); }
</pre>
</div>

<p>
https is for confidence and integrity.  If a single resource is not http all confidence and integrity is lost.
Hence the Mixed content warning in browsersn
</p>
</div>
</div>

<div id="outline-container-sec-10-3-3" class="outline-4">
<h4 id="sec-10-3-3">Protocol Relative Content</h4>
<div class="outline-text-4" id="text-10-3-3">
<p>
Browser load content relative URL using the parent pages scheme.
</p>

<div class="org-src-container">

<pre class="src src-xml">&lt;!-- Note the // --&gt;
&lt;script src="//ajax.com/jquery.js" type="text/javascript" &gt;&lt;/script&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-10-3-4" class="outline-4">
<h4 id="sec-10-3-4">Using HTTP strict transport security (HSTS)</h4>
<div class="outline-text-4" id="text-10-3-4">
<p>
Stop browser from making any unsecure request with HSTS header.
HSTS header stops man in the middle requests.
</p>

<div class="org-src-container">

<pre class="src src-csharp">HttpContext.Current.Response.AddHeader("Strict-Transport-Security", "max-age=31536000");
</pre>
</div>
</div>

<div id="outline-container-sec-10-3-4-1" class="outline-5">
<h5 id="sec-10-3-4-1">HSTS Restrictions</h5>
<div class="outline-text-5" id="text-10-3-4-1">
<ul class="org-ul">
<li>Header will only be observed if sent with https response
</li>
<li>Certificate must be trusted
</li>
<li>User needs to send http request first that doesn't get hijacked
</li>
<li>Browser Support is patch. Some browser force some sites out of the box (eg. chrome, amazon)
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10-3-5" class="outline-4">
<h4 id="sec-10-3-5">Insuficient TLS patterns</h4>
<div class="outline-text-4" id="text-10-3-5">
<ul class="org-ul">
<li>Loading login from http, but post to https
</li>
<li>https form inside https inside a http iframe
</li>
<li>Allowing http when there is no use case where it ever should be
</li>
<li>Passing sensitive information in a https url.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-3-6" class="outline-4">
<h4 id="sec-10-3-6">Https considerations.</h4>
<div class="outline-text-4" id="text-10-3-6">
<ul class="org-ul">
<li>SSL comes at a cost. but it was a 1% cpu load, and 2% network overhead for google in 2010.
</li>
<li>Inital unsecure requests can always be picked up be man in the middle attacks. eg MithM attacks like <code>sslstrip</code> then fake the https.
</li>
<li>Intergirty of the Certificate Authenticaties is paramount to the whole https landscape.
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10-4" class="outline-3">
<h3 id="sec-10-4">Summary</h3>
<div class="outline-text-3" id="text-10-4">
<ul class="org-ul">
<li>There are many methods of implementing HTTPS insuficuently
</li>
<li>Cookies can be sensitive because of what they allow the user to do
</li>
<li>Resource that require secure connection shouldn't be loaded over insecure connectiosn
</li>
<li>Loading insecure resource destroy the integrity of secure pages in included in the load
</li>
<li>Use HSTS for secure sites, but support is limited
</li>
<li>Avoid antipatterns of, login forms over http, insecure pages embedding secure login forms, sensitive dat in the secure urls.
</li>
<li>SSL have overhead, just not much
</li>
<li>SSL is not fool proof.
</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">Unvalidated Redirects and Forwards (Open redirects</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1">The Matrix</h3>
<div class="outline-text-3" id="text-11-1">
</div><div id="outline-container-sec-11-1-1" class="outline-4">
<h4 id="sec-11-1-1">Threat Agents</h4>
<div class="outline-text-4" id="text-11-1-1">
<ul class="org-ul">
<li>any one who can trick users into submitting requests
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-1-2" class="outline-4">
<h4 id="sec-11-1-2">Attack Vectors&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-11-1-2">
<ul class="org-ul">
<li>links to unvalided redirect and trick victent to clicking it.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-1-3" class="outline-4">
<h4 id="sec-11-1-3">Security Weaknesses</h4>
<div class="outline-text-4" id="text-11-1-3">
</div><div id="outline-container-sec-11-1-3-1" class="outline-5">
<h5 id="sec-11-1-3-1">Prevalene&#xa0;&#xa0;&#xa0;<span class="tag"><span class="yellow">yellow</span></span></h5>
<div class="outline-text-5" id="text-11-1-3-1">
<ul class="org-ul">
<li>Appl frequenly redirect users, or use internal forwards, sometimes the page is specified in an unvalidated parameter
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-1-3-2" class="outline-5">
<h5 id="sec-11-1-3-2">Detectability&#xa0;&#xa0;&#xa0;<span class="tag"><span class="red">red</span></span></h5>
<div class="outline-text-5" id="text-11-1-3-2">
<ul class="org-ul">
<li>Easy to find, anywhere you can set the full url
</li>
<li>Unchecked forwards are harder, since they target internal pages
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-11-1-4" class="outline-4">
<h4 id="sec-11-1-4">Technical Impact (dependand on asset)&#xa0;&#xa0;&#xa0;<span class="tag"><span class="orange">orange</span></span></h4>
<div class="outline-text-4" id="text-11-1-4">
<ul class="org-ul">
<li>Attempts to install malware, phishing, disclosing sensitive information
</li>
<li>Unsafge forwards may allow access controll bypass
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-1-5" class="outline-4">
<h4 id="sec-11-1-5">Business Impact (dependent on nature of data)</h4>
<div class="outline-text-4" id="text-11-1-5">
<dl class="org-dl">
<dt> Consider value of </dt><dd><ul class="org-ul">
<li>retaining users trust
</li>
</ul>
</dd>

<dt> Include in consideration impact of </dt><dd><ul class="org-ul">
<li>client getting owned
</li>
<li>attackers access internal only functions
</li>
</ul>
</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2">Notes</h3>
<div class="outline-text-3" id="text-11-2">
<blockquote>
<p>
Use a legitimate domain to serve malicious urls.
</p>
</blockquote>

<p>
Attack exploits trust in the target site.
Includes users, and also for bots. Victim is focussed on the domain.
</p>

<dl class="org-dl">
<dt> Delivering 'loaded' URLs </dt><dd><ul class="org-ul">
<li>Distribute Malicious payload
</li>
<li>Automated tools (spam filters,&#x2026;) struggle with the url due to legitimate domain.
</li>
<li>URLs are often trucated to the legitimate domain only
</li>
<li>URL encoding every character obfuscated the actual path
</li>
</ul>
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-11-3" class="outline-3">
<h3 id="sec-11-3">Security in Depth</h3>
<div class="outline-text-3" id="text-11-3">
</div><div id="outline-container-sec-11-3-1" class="outline-4">
<h4 id="sec-11-3-1">Perform checksd on the request.</h4>
<div class="outline-text-4" id="text-11-3-1">
<ol class="org-ol">
<li>Whitelist the redirect
</li>
<li>Check to see is a user is coming from own own site.
</li>
</ol>

<div class="org-src-container">

<pre class="src src-csharp">var url = Request.QueryString["redirectTo"];

// 2. Check to see is a user is coming from own own site.
var referrer = Request.UrlReferrer;
if (referrer.?Host != Request.Url.Host) {
  throw new ApplicationException("Referrer is not this site.");
}

// 1. Whitelist the redirect
var db = new TrustedUrlsContext();
if (!db.TrustedUrls.Any(x =&gt; x.Url == url)) {
  throw new ApplicationException("URL not trusted");
}
Response.Redirect(url);
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-11-3-2" class="outline-4">
<h4 id="sec-11-3-2">Other Concerns</h4>
<div class="outline-text-4" id="text-11-3-2">
<ul class="org-ul">
<li>Often viewed as a light risk, used as a launchpad
</li>
<li>Google does not pay bug bounties for the risk.
</li>
<li>Risk is about reputation
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-11-4" class="outline-3">
<h3 id="sec-11-4">Summary</h3>
<div class="outline-text-3" id="text-11-4">
<ul class="org-ul">
<li>Unvalidated redirect pose value by posing legitamacy to launch an attack
</li>
<li>Redirecting users is valid ussually only if the target is trusted
</li>
<li>Referrer checking can mitigate but is not foolproof
</li>
<li>Often not viewed as a major risk, but the risk is to reputation
</li>
</ul>
</div>
</div>
</div>
